---
authors:
  - frank
tags:
  - wiki
  - utf-8
  - encode
description: Wiki UTF8
keywords:
  - Wiki UTF8
image: https://i.imgur.com/mErPwqL.png
date: 2023-12-08
draft: false
enableComments: true # for Gisqus
---

# Wiki Unicode

The smallest unit of all texts we see on the screen is one character.

In Unicode, a character maps to something called code point which is a magic number written as hex like: `U+20AC` and is still just a abstract layer.

glyph,
unicode character,
unicode code point,
variable-length bytes(1 to 4 bytes)

How that code point is represented in memory or on disk?

`UTF-8`, `UTF-16`, and `UTF-32` help translate unicode code point into binary data in 8-bit bytes which can be saved in disk or be transported in network.

`UTF-8` is character-to-bytes(1 to 4 bytes) encoding standard across almost all system and application.

<!--truncate-->

## FAQ

### How a character is displayed on the screen?

software maps each character to its glyph(a grid of pixels), draw these pixels onto the screen.

### How to find out whether the file uses UTF-8 or ASCII or other encoding schemas?

It's not always foolproof because there is no universal mandate or requirement that all files must specify their encoding. But it's a good practice to add BOM(Byte Order Mark) at the beginning of a UTF-8 encoded file.

### Can I set UTF-16 as locale in Linux?

No, you cannot. Linux use `UTF-8` encoding which is compatible with `ASCII`.

### What happens when printing a UTF-16 file in Linux?

```sh
# >>> '€'.encode("utf16") -> b'\xff\xfe\xac '
$ echo -n -e \\xff\\xfe\\xac\\x20 > a.txt
$ hexdump -C a.txt
00000000  ff fe ac 20                                       |... |
00000004
$ file a.txt
a.txt: Unicode text, UTF-16, little-endian text, with no line terminators
$ cat a.txt
���
$ iconv -f UTF-16LE -t UTF-8 a.txt
€
```

### How can I check a UTF-8 file has a `BOM`?

Create a file without `BOM`,

```py
>>> f.flush()
>>> b'\xe2\x82\xac'.decode()
'€'
>>> '€'.encode()
b'\xe2\x82\xac'
>>> bom=b"\xef\xbb\xbf"
>>> f=open("a.txt", "wb+")
>>> f.write(b'\xe2\x82\xac')
3
>>> f.flush()
```

```sh
$ file a.txt
a.txt: Unicode text, UTF-8 text, with no line terminators
```

Create a `BOM` adhere file,

```py
>>> f.seek(0)
0
>>> f.truncate(0)
0
>>> f.write(b'\xef\xbb\xbf\xe2\x82\xac')
6
>>> f.flush()
```

```sh
$ file a.txt
a.txt: Unicode text, UTF-8 (with BOM) text, with no line terminators
$ hexdump -C a.txt
00000000  ef bb bf e2 82 ac                                 |......|
00000006
```

### Why we can copy and paste the unicode characters into a shell?

When we do copying on the screen, we're copying the character's binary data which is in the `os` memory not the code point inside memory.

```sh
# b'\xe2\x82\xac'.decode() -> '€'
$ echo -e \\xe2\\x82\\xac | xclip -selection clipboard
```

Then you can use your mouse right click to copy to the shell and you will see `€`.

### How a string is stored in memory when Python running?



## Unicode in JSON

```py
>>> import json
>>> b=b'{"text": "\u4f60\u597d"}'
>>> json.loads(b)
{'text': '你好'}jsn
>>> json.dumps(json.loads(b))
'{"text": "\\u4f60\\u597d"}'
>>> json.dumps(json.loads(b), ensure_ascii=False)
'{"text": "你好"}'
```

```py
>>> f=open("a.txt", "w+")
>>> f.write(json.dumps(json.loads(b)))
24
>>> f.flush()
```

```sh
$ cat a.txt
{"text": "\u4f60\u597d"}#
$  hexdump -C a.txt
00000000  7b 22 74 65 78 74 22 3a  20 22 5c 75 34 66 36 30  |{"text": "\u4f60|
00000010  5c 75 35 39 37 64 22 7d                           |\u597d"}|
00000018
```

```py
>>> f.seek(0)
0
>>> f.truncate(0)
0
>>> f.write(json.dumps(json.loads(b), ensure_ascii=False))
14
>>> f.flush()
```

```sh
$ cat a.txt
{"text": "你好"}#
$ hexdump -C a.txt
00000000  7b 22 74 65 78 74 22 3a  20 22 e4 bd a0 e5 a5 bd  |{"text": "......|
00000010  22 7d                                             |"}|
00000012
```

## Base64

## Python 


## Resources

[The Absolute Minimum Every Software Developer Absolutely, Positively Must Know About Unicode and Character Sets (No Excuses!) – Joel on Software](https://www.joelonsoftware.com/2003/10/08/the-absolute-minimum-every-software-developer-absolutely-positively-must-know-about-unicode-and-character-sets-no-excuses/)

[Pragmatic Unicode | Ned Batchelder](https://nedbatchelder.com/text/unipain.html)