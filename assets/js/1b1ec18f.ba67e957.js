"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[509],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>h});var a=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=a.createContext({}),c=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},u=function(e){var n=c(e.components);return a.createElement(s.Provider,{value:n},e.children)},p="mdxType",m={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},d=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),p=c(t),d=r,h=p["".concat(s,".").concat(d)]||p[d]||m[d]||i;return t?a.createElement(h,l(l({ref:n},u),{},{components:t})):a.createElement(h,l({ref:n},u))}));function h(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=t.length,l=new Array(i);l[0]=d;var o={};for(var s in n)hasOwnProperty.call(n,s)&&(o[s]=n[s]);o.originalType=e,o[p]="string"==typeof e?e:r,l[1]=o;for(var c=2;c<i;c++)l[c]=t[c];return a.createElement.apply(null,l)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},29346:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>l,default:()=>m,frontMatter:()=>i,metadata:()=>o,toc:()=>c});var a=t(87462),r=(t(67294),t(3905));const i={foam_template:{name:"Blog Docusaurus Template",description:"Creates Docusaurus blog/slip",filepath:"blog/wiki-cross-compilation.mdx"},authors:["frank"],tags:["wiki","cross-compilation"],description:"Wiki Cross Compilation",keywords:["Wiki Cross Compilation"],image:"https://i.imgur.com/mErPwqL.png",date:new Date("2023-09-18T00:00:00.000Z"),draft:!1,enableComments:!0},l="Cross Compilation",o={permalink:"/blog/wiki-cross-compilation",editUrl:"https://github.com/liviaerxin/liviaerxin.github.io/edit/master/_ssg/docusaurus/../../blog/wiki-cross-compilation.mdx",source:"@site/../../blog/wiki-cross-compilation.mdx",title:"Cross Compilation",description:"Wiki Cross Compilation",date:"2023-09-18T00:00:00.000Z",formattedDate:"September 18, 2023",tags:[{label:"wiki",permalink:"/blog/tags/wiki"},{label:"cross-compilation",permalink:"/blog/tags/cross-compilation"}],readingTime:2.51,hasTruncateMarker:!0,authors:[{name:"Frank Chen",title:"Maintainer of Docusaurus",url:"https://github.com/liviaerxin",imageURL:"https://github.com/liviaerxin.png",key:"frank"}],frontMatter:{foam_template:{name:"Blog Docusaurus Template",description:"Creates Docusaurus blog/slip",filepath:"blog/wiki-cross-compilation.mdx"},authors:["frank"],tags:["wiki","cross-compilation"],description:"Wiki Cross Compilation",keywords:["Wiki Cross Compilation"],image:"https://i.imgur.com/mErPwqL.png",date:"2023-09-18T00:00:00.000Z",draft:!1,enableComments:!0},prevItem:{title:"Coral",permalink:"/blog/wiki-coral"},nextItem:{title:"Samba Wiki",permalink:"/blog/wiki-samba"}},s={authorsImageUrls:[void 0]},c=[{value:"GCC",id:"gcc",level:2},{value:"Obtaining a cross-compilation toolchain for <code>aarch64</code>",id:"obtaining-a-cross-compilation-toolchain-for-aarch64",level:3},{value:"Where is <code>cross compiler</code>",id:"where-is-cross-compiler",level:3},{value:"Where is <code>sysroot</code>",id:"where-is-sysroot",level:3},{value:"Compile <code>hello.c</code>",id:"compile-helloc",level:3},{value:"Clang/LLVM",id:"clangllvm",level:2},{value:"Resources",id:"resources",level:2}],u={toc:c},p="wrapper";function m(e){let{components:n,...t}=e;return(0,r.kt)(p,(0,a.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Cross-Compilation ecosystem involves the following components:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"host system",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"cross-Compilation toolchain",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"cross compiler"),(0,r.kt)("li",{parentName:"ul"},"cross linker"),(0,r.kt)("li",{parentName:"ul"},"cross debugger"),(0,r.kt)("li",{parentName:"ul"},"sysroot",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"target system library files"),(0,r.kt)("li",{parentName:"ul"},"target system header files"),(0,r.kt)("li",{parentName:"ul"},"target system other files"))))))),(0,r.kt)("li",{parentName:"ul"},"target system")),(0,r.kt)("p",null,"Cross-Compilation toolchain:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"GCC"),(0,r.kt)("li",{parentName:"ul"},"Buildroot"),(0,r.kt)("li",{parentName:"ul"},"Yocto Project"),(0,r.kt)("li",{parentName:"ul"},"Crosstool-NG"),(0,r.kt)("li",{parentName:"ul"},"Linaro"),(0,r.kt)("li",{parentName:"ul"},"Clang/LLVM")),(0,r.kt)("h2",{id:"gcc"},"GCC"),(0,r.kt)("p",null,"Let's explore what a toolchain is like and what are needed to build something for a ",(0,r.kt)("inlineCode",{parentName:"p"},"aarch64")," platform on ",(0,r.kt)("inlineCode",{parentName:"p"},"x86_64")," debian-like host."),(0,r.kt)("h3",{id:"obtaining-a-cross-compilation-toolchain-for-aarch64"},"Obtaining a cross-compilation toolchain for ",(0,r.kt)("inlineCode",{parentName:"h3"},"aarch64")),(0,r.kt)("p",null,"For simplicity and in a super fast way, we will use a prebuilt and ready-on toolchain in ",(0,r.kt)("inlineCode",{parentName:"p"},"x86_64")," Ubuntu."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"apt install gcc make gcc-aarch64-linux-gnu binutils-aarch64-linux-gnu\n")),(0,r.kt)("h3",{id:"where-is-cross-compiler"},"Where is ",(0,r.kt)("inlineCode",{parentName:"h3"},"cross compiler")),(0,r.kt)("p",null,"We see ",(0,r.kt)("inlineCode",{parentName:"p"},"cross compiler")," binary type in host is ",(0,r.kt)("inlineCode",{parentName:"p"},"x86-64"),","),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"$ file /usr/bin/aarch64-linux-gnu-gcc-11\n/usr/bin/aarch64-linux-gnu-gcc-11: ELF 64-bit LSB executable, x86-64, version 1 (GNU/Linux), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=b1112487d0dcb759db32e15b8f40f28a05484272, for GNU/Linux 3.2.0, stripped\n")),(0,r.kt)("h3",{id:"where-is-sysroot"},"Where is ",(0,r.kt)("inlineCode",{parentName:"h3"},"sysroot")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"sysroot")," locates in ",(0,r.kt)("inlineCode",{parentName:"p"},"/usr/aarch64-linux-gnu"),","),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"$ tree --filelimit=100 /usr/aarch64-linux-gnu\n/usr/aarch64-linux-gnu\n\u251c\u2500\u2500 bin\n\u2502\xa0\xa0 \u251c\u2500\u2500 ar -> ../../bin/aarch64-linux-gnu-ar\n\u2502\xa0\xa0 \u251c\u2500\u2500 as -> ../../bin/aarch64-linux-gnu-as\n\u2502\xa0\xa0 \u251c\u2500\u2500 ld -> ../../bin/aarch64-linux-gnu-ld\n\u2502\xa0\xa0 \u251c\u2500\u2500 ld.bfd -> ../../bin/aarch64-linux-gnu-ld.bfd\n\u2502\xa0\xa0 \u251c\u2500\u2500 ld.gold -> ../../bin/aarch64-linux-gnu-ld.gold\n\u2502\xa0\xa0 \u251c\u2500\u2500 nm -> ../../bin/aarch64-linux-gnu-nm\n\u2502\xa0\xa0 \u251c\u2500\u2500 objcopy -> ../../bin/aarch64-linux-gnu-objcopy\n\u2502\xa0\xa0 \u251c\u2500\u2500 objdump -> ../../bin/aarch64-linux-gnu-objdump\n\u2502\xa0\xa0 \u251c\u2500\u2500 ranlib -> ../../bin/aarch64-linux-gnu-ranlib\n\u2502\xa0\xa0 \u251c\u2500\u2500 readelf -> ../../bin/aarch64-linux-gnu-readelf\n\u2502\xa0\xa0 \u2514\u2500\u2500 strip -> ../../bin/aarch64-linux-gnu-strip\n\u251c\u2500\u2500 include  [139 entries exceeds filelimit, not opening dir]\n\u2514\u2500\u2500 lib\n    \u251c\u2500\u2500 Mcrt1.o\n    \u251c\u2500\u2500 Scrt1.o\n    \u251c\u2500\u2500 crt1.o\n    \u251c\u2500\u2500 crti.o\n    \u251c\u2500\u2500 crtn.o\n    \u251c\u2500\u2500 gcrt1.o\n    \u251c\u2500\u2500 grcrt1.o\n    \u251c\u2500\u2500 ld-linux-aarch64.so.1\n")),(0,r.kt)("p",null,"As you see, the ",(0,r.kt)("inlineCode",{parentName:"p"},"binutils-aarch64-linux-gnu")," will install ",(0,r.kt)("inlineCode",{parentName:"p"},"binutils")," tools in ",(0,r.kt)("inlineCode",{parentName:"p"},"/usr/aarch64-linux-gnu/bin"),","),(0,r.kt)("p",null,"These ",(0,r.kt)("inlineCode",{parentName:"p"},"binutils")," are also ",(0,r.kt)("inlineCode",{parentName:"p"},"x86_64")," binaries,"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"}," file $(readlink -f /usr/aarch64-linux-gnu/bin/ar)\n/usr/bin/aarch64-linux-gnu-ar: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=4f75b6dc6fe5ae92c78a51e6479ca2c65bbf5335, for GNU/Linux 3.2.0, stripped\n")),(0,r.kt)("p",null,"While target libraries are ",(0,r.kt)("inlineCode",{parentName:"p"},"aarch64")," type,"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"file /usr/aarch64-linux-gnu/lib/crt1.o\n/usr/aarch64-linux-gnu/lib/crt1.o: ELF 64-bit LSB relocatable, ARM aarch64, version 1 (SYSV), for GNU/Linux 3.7.0, not stripped\n")),(0,r.kt)("h3",{id:"compile-helloc"},"Compile ",(0,r.kt)("inlineCode",{parentName:"h3"},"hello.c")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"$ aarch64-linux-gnu-gcc-11 hello.c -o a.out\n$ file a.out\na.out: ELF 64-bit LSB pie executable, ARM aarch64, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux-aarch64.so.1, BuildID[sha1]=367c436db0697f16039d9249e4a4e809ef9e68b3, for GNU/Linux 3.7.0, not stripped\n")),(0,r.kt)("h2",{id:"clangllvm"},"Clang/LLVM"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://static.linaro.org/connect/bkk19/presentations/bkk19-210.pdf"},"Cross compilation with Clang and LLVM tools")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://mcilloni.ovh/2021/02/09/cxx-cross-clang/"},"Cross compiling made easy, using Clang and LLVM \xb7 mcilloni's blog")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"apt install lld clang llvm\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"$ wget https://releases.linaro.org/components/toolchain/binaries/7.5-2019.12/aarch64-linux-gnu/sysroot-glibc-linaro-2.25-2019.12-aarch64-linux-gnu.tar.xz\n\n$ tar -xvf sysroot-glibc-linaro-2.25-2019.12-aarch64-linux-gnu.tar.xz\n\n$ mv sysroot-glibc-linaro-2.25-2019.12-aarch64-linux-gnu aarch64-linux-gnu\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"$ ll aarch64-linux-gnu\ntotal 20K\ndrwxr-xr-x 2 11827 9000 4.0K Dec  4  2019 etc\ndrwxr-xr-x 3 11827 9000 4.0K Dec  4  2019 lib\ndrwxr-xr-x 2 11827 9000 4.0K Dec  4  2019 sbin\ndrwxr-xr-x 8 11827 9000 4.0K Dec  4  2019 usr\ndrwxr-xr-x 3 11827 9000 4.0K Dec  4  2019 var\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'$ cat > hello.c << EOL\n#include <stdio.h>\nint main(int argc, char *argv[])\n{\n  printf("Hello cross-compilation world!\\n");\n  return 0;\n}\nEOL\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"sysroot=$PWD/aarch64-linux-gnu/usr\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"clang --target=aarch64-linux-gnu  -fsanitize=undefined \\\n    -fuse-ld=lld \\\n    --rtlib=compiler-rt -stdlib=libc++ \\\n    -nostdinc++ -nostdlib \\\n    -I${sysroot}/usr/include/ \\\n    -Wl,-L${sysroot}/usr/lib \\\n    --sysroot=$sysroot \\\n    --verbose \\\n    hello.c -o hello\n")),(0,r.kt)("h2",{id:"resources"},"Resources"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/generia/buildroot-osx"},"https://github.com/generia/buildroot-osx")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://crosstool-ng.github.io/docs/"},"https://crosstool-ng.github.io/docs/")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/messense/homebrew-macos-cross-toolchains/blob/main/.github/workflows/aarch64.yml"},"https://github.com/messense/homebrew-macos-cross-toolchains/blob/main/.github/workflows/aarch64.yml")))}m.isMDXComponent=!0}}]);